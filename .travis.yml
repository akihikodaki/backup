language: node_js
matrix:
  include:
    - os: linux
      dist: trusty
      sudo: false
      addons:
        postgresql: 10
      services:
        - redis-server
    - os: linux
      dist: trusty
      sudo: false
      addons:
        postgresql: 9.6
      services:
        - redis-server
    - os: linux
      dist: trusty
      sudo: false
      addons:
        postgresql: 9.5
      services:
        - redis-server
    - os: linux
      dist: trusty
      sudo: false
      addons:
        postgresql: 9.4
    - os: linux
      dist: trusty
      sudo: false
      addons:
        postgresql: 9.3
      services:
        - redis-server
      services:
        - redis-server
    - os: osx
      before_install:
        - brew install redis
      before_script:
        - pg_ctl -D /usr/local/var/postgres start
        - redis-server --daemonize yes
cache:
  directories:
    - node_modules
node_js:
  - lts/*
  - node
before_script:
  - createdb travis_miniverse_test_1
  - PGDATABASE=travis_miniverse_test_1 npx db-migrate up
script:
  - npm test -- -w 1
